{% extends "gui/layout.html" %} 
{% load crispy_forms_tags %} 
{% comment %} {% load random_int %} {% endcomment %}
{% block content %}

<style>
  .carousel-item-main {
  height: 15vh;
  min-height: 150px;
  background: no-repeat center center scroll;
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
}
h4.justify-content-center.text-center {
    margin:auto;
}

        .col-md-3
          {
          display: inline-block;
          margin-left:-4px;
          }

          .carousel-indicators .active {
          background-color: blue;
            }

          .col-md-3 img{

          width: 100px;
          height: 100px;
          }

          body .carousel-indicator li{
          background-color: blue;
          }

          body .carousel-indicators{
          bottom: 0;
          }

          body .carousel-control-prev-icon-deal,
          body .carousel-control-next-icon-deal{
          background-color: red;
          }
          body .carousel-control-prev-icon,
          body .carousel-control-next-icon{
          background-color: red;
          }

          .carousel-control-prev,
          .carousel-control-next{
          top: 80%;
          bottom: auto;
          }
           body .no-padding{
           padding-left: 0;
           padding-right: 0;
           }
           .blue-rectangle {
  color:white;
  text-transform: uppercase;
  font-size:18px;
  padding: 10px 20px 10px 50px;
  background-color: rgba(3,78,136,0.7);
  width: 200px;
  position: relative;
  margin-left: 50px;
}
.blue-rectangle:after {
  content: "";
  position: absolute;
  border: 21px solid transparent;
  border-top-color: rgba(3,78,136,0.7);
  border-left-color: rgba(3,78,136,0.7);
  left: 100%;
  top: 0;
  width: 0;
  height: 0
}
</style>

<header>
  <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
    <ol class="carousel-indicators">
      <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
      <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
      <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
    </ol>
    <div class="carousel-inner" role="listbox">
      <!-- Slide One - Set the background image for this slide in the line below -->
      <div class="carousel-item carousel-item-main active" style="background-image: url('https://source.unsplash.com/RCAhiGJsUUE/1920x1080')">
        <div class="carousel-caption d-none d-md-block">
          <b><h3 class="display-4 text-capitalize">Find Wholesalers Stores.</h3></b>
          <p class="lead"></p>
        </div>
      </div>
      <!-- Slide Two - Set the background image for this slide in the line below -->
      <div class="carousel-item carousel-item-main" style="background-image: url('https://source.unsplash.com/wfh8dDlNFOk/1920x1080')">
        <div class="carousel-caption d-none d-md-block">
          <h3 class="display-4 text-capitalize">Sell Your Products.</h3>
          <p class="lead"></p>
        </div>
      </div>
      <!-- Slide Three - Set the background image for this slide in the line below -->
      <div class="carousel-item carousel-item-main bg-dark" style="background-image: ">
        <div class="carousel-caption d-none d-md-block">
          <h3 class="display-4 text-capitalize">Find Best Selling Products.</h3>
          {% comment %} <p class="lead">Find Best Selling Products</p> {% endcomment %}
        </div>
      </div>
    </div>
    <a class="carousel-control-prev carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
  </div>
</header>


<div class="container-fluid">
    <h1 class="blue-rectangle mt-3 mr-4">Deals</h1>
<div id="demo" class="carousel slide my-3" data-ride="carousel">
    <ul class="carousel-indicators">
      <li data-target="#demo" data-slide-to="0" class="active"></li>

       {% for i in range %}
      <li data-target="#demo" data-slide-to="{{i}}" ></li>
      {% endfor %}
    </ul>

    <!--Slideshow starts here -->
    <div class="container carousel-inner no-padding">

      <div class="carousel-item carousel-item-deals active">
        <div class="col-xs-3 col-sm-3 col-md-3">
          <div class="card card-img-top img-responsive mx-auto d-block text-center z-depth-0 border border-light" style="width: 16rem; height: 14rem;">
            <img src='{{products_slider.0.image.url}}' class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title"><a style="color:black" class="text-black"href="{% url 'detailview' products_slider.0.id %}">{{products_slider.0.title}}</a></h5>
                <p class="card-text p-0 m-0">{{products_slider.0.category}}</p>
                <span class="float-right"><small><del>{{products_slider.0.price}}</del></small> - <ins>{{products_slider.0.deal_price}}</ins> Rs <i class="badge  ml-1 z-depth-0" style="background-color:#034e88b3">Discount</i></span>
            </div>
          </div>
       </div>


        {% for i in products_slider|slice:"1:"%}
        <div class="col-xs-3 col-sm-3 col-md-3">
          <div class="card card-img-top img-responsive mx-auto d-block text-center z-depth-0 border border-light" style="width: 16rem; height: 14rem;">
            <img src='{{i.image.url}}' class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title"><a style="color:black" class="text-black"href="{% url 'detailview' i.id %}">{{i.title}}</a></h5>
              <p class="card-text p-0 m-0">{{i.category}}</p>
              <span class="float-right"><small><del>{{i.price}}</del></small> - <ins>{{i.deal_price}}</ins> Rs <i class="badge ml-1 z-depth-0" style="background-color:#034e88b3">Discount</i></span>
            </div>
          </div>
        </div>
        {% if forloop.counter|divisibleby:3 and forloop.counter > 0 and not forloop.last %}
      </div><div class="carousel-item carousel-item-deals">
        {% endif %}

        {% endfor %}
    </div>



</div>
</div>
    <!-- left and right controls for the slide -->
    <div>
    <a class="carousel-control-prev carousel-control-prev" href="#demo" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon carousel-control-prev-icon-deal" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
    </div>
    <div>
    <a class="carousel-control-next" href="#demo" role="button" data-slide="next">
          <span class="carousel-control-next-icon carousel-control-next-icon-deal" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
    </div>

</div>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-12 pt-3">
      <form class="form-inline d-flex justify-content-center ">
      <div class="mr-1" width="100%">
      <input
          min="0"
          type="number"
          name="min-price"
          class="form-control mt-2"
          placeholder="Min price"
        />
      <input
          min="0"
          type="number"
          name="max-price"
          class="form-control mt-2"
          placeholder="Max price"
        />
      {% comment %} </div> {% endcomment %}
      <select class="browser-default custom-select mt-2" name="category">
      <option selected>Select Category</option>
          {% for cat in categories %}
          <option value="{{cat}}">{{cat}}</option>
          {% endfor%}
    </select>
      </div>
        <input
          style=""
          type="text"
          name="title"
          class="form-control mt-2"
          placeholder="Search Product"
        />
        <div class="mt-2"><button class="btn btn-primary btn-md" type="submit">Search</button></div>
      </form>
    </div>
  </div>

{% for message in messages %}
<div class="container" id="message-container">
  <div class="alert {{ message.tags }} alert-dismissible" role="alert" >
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
    {{ message }}
  </div>
</div>
{% endfor %}



</div>

<div class="container">
  <div class="row">
    {% if product %} {% for product in product %}
    <div class="col-sm-6 col-lg-3 col-md-4  p-2 ">
      <div
        class="card card-cascade card-ecommerce m-0 p-0 z-depth-0 border border-light"
        style="height:315px"
      >
        <div class="view view-cascade overlay">
          <img
            class="card-img-top img-responsive mx-auto d-block text-center"
            style="height: 120px; width: auto"
            src="{{product.image.url}}"
            alt=""
            loading="lazy"
          />
          <a>
            {% comment %} <div class="mask rgba-white-slight"></div> {% endcomment %}
          </a>
        </div>
        <div class="card-body card-body-cascade">
          <h6 class="card-title m-0 p-0" style="text-transform: capitalize;text-decoration:none">
            <strong
              ><a style="color:black" class="text-black"href="{% url 'detailview' product.id %}"
                >{{product.title}}</h6
              ></strong

            >
          </h6>
          <hr class="rounded">
          {% comment %} <small>{{product.category}}</small><br /> {% endcomment %}
          {% if product.average_rating %}
          <span style="color: orange">{{product.average_rating | floatformat}}</span>
          <span style="color: orange" class="fa fa-star checked m-0 p-0"></span>
              {% if product.deal_status == 1%}
              <span class="float-right"><small><del>{{product.price}}</del></small> - <small><ins>{{product.deal_price}}</ins> Rs <i class="badge badge-sm badge-success ml-1">Discount</i></small></span>
              {% else %}
              <span class="float-right"><small>{{product.price}} Rs </small></span>
              {% endif%}
          {% elif product.average_rating == true %}
          <small>Not rated Yet</small>
          {% endif%}
          <div class="text-center">
             <span class="float-left"
              ><small
                >Min order
                <span class="badge badge-primary">{{product.minorder}}</span></small
              ></span
            >
          </div>
          <div class="mt-5">
          {% if request.user.is_authenticated %}
            {% if product.user == request.user %}
            <a
            href="{% url 'updateproduct' product.id %}"
            class="btn btn-primary btn-sm  text-center"
          >
            Edit
          </a>              
            {% else  %}
          <a
            class="btn btn-primary btn-sm add-btn update-cart text-center"
            data-product="{{product.id}}"
            data-minorder="{{product.minorder}}"
            onClick="window.location.reload();"
            data-action="add"
          >
            Add to cart
          </a>
            {% endif %}
          {% else %}
          <a
            onclick="showAlert()"
            id="login-alert"
            class="btn btn-primary btn-sm "
            style="text-decoration: none !important; cursor: pointer"
            href="{% url 'login'%}"
            >Add to cart</a
          >
          {% endif %}
          <span class="">
          {% if request.user.is_authenticated %}
            <span class="float-right mt-2 p-2"
              ><a
                style="color:black"
                class="float-right"
                href="{% url 'add_to_wishlist' product.id %}"
                data-toggle="tooltip"
                data-placement="top"
                title="Add to Wishlist"
                ><i class="fas fa-heart"></i></a
            ></span>
            {% else %}
            <span class="float-right mt-2 p-2"
              ><a
                style="color:black"
                class="float-right "
                href="{% url 'login' %}"
                onclick="wishlist_alert()"
                data-toggle="tooltip"
                data-placement="top"
                title="Add to Wishlist"
                ><i class="fas fa-heart"></i></a
            ></span>
            {% endif %}
            </span>
            </div>
        </div>
      </div>
    </div>
    {% endfor %}
    {% else %} 
    <h4 class="justify-content-center text-center">No Product Found</h4>
    {% endif %}
  </div>
</div>

<!--/.Card-->

<div class="row offset-4 justify-content-center">
  <div class="col-sm-8 pt-4">
    {% if product.has_other_pages %}
    <ul class="pagination pagination-lg">
      {% if product.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ product.previous_page_number }}"
          >&laquo;</a
        >
      </li>
      {% else %}
      <li class="page-item disabled">
        <a class="page-link" href="#"><span>&laquo;</span></a>
      </li>
      {% endif %} 
      {% for i in product.paginator.page_range %} 
      {% if product.number == i %}
      <li class="page-item active">
        <a class="page-link" href="#"
          >{{ i }} <span class="sr-only">(current)</span></a
        >
      </li>
      {% else %}
      <li class="page-item">
        <a class="page-link" href="?page={{ i }}">{{ i }}</a>
      </li>
      {% endif %} 
      {% endfor %} 
      {% if product.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ product.next_page_number }}"
          >&raquo;</a
        >
      </li>
      {% else %}
      <li class="page-item disabled">
        <a class="page-link" href="#"><span>&raquo;</span></a>
      </li>
      {% endif %}
    </ul>
    {% endif %}
  </div>
</div>
<script>

  function showAlert() {
    alert("Login First to add items in cart");
  }
  function wishlist_alert() {
    alert("Login First to Add items in Wishlist");
  }
    var message_ele = document.getElementById("message-container");

setTimeout(function(){ 
   message_ele.style.display = "none"; 
}, 2000);
    </script>
{% endblock %}
